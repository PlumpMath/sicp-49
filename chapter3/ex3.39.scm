;;
;; @author naoiwata
;; SICP Chapter3
;; Exercise 3.39.
;;

; ------------------------------------------------------------------------
; question
; ------------------------------------------------------------------------

(define x 10)

(define s (make-serializer))

(parallel-execute 
  (lambda () 
    (set! x ((s (lambda () (* x x))))))
  (s (lambda () (set! x (+ x 1)))))

; ------------------------------------------------------------------------
; solution
; ------------------------------------------------------------------------

; 101 -> (set (* x x)) -> (set (+ x 1))
; 121 -> (set (+ x 1)) -> (set (* x x))
; 100 -> (* x x) -> (+ x 1) -> (set (* x x))

; END